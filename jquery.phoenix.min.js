!function(e,t){"use strict";var i,n,s,r,o;s="phoenix",n={namespace:"phoenixStorage",webStorage:"localStorage",maxItems:100,saveInterval:1e3,expireTime:!1,clearOnSubmit:!1,saveOnChange:!1,saveOnInput:!1,ignoreUri:!1,keyAttributes:["tagName","id","name"]},r=[],i=function(){function i(i,r){var o,a,h;this.element=i,this._defaults=n,this._name=s,this.$element=e(this.element),this.options=e.extend({},n,"object"==typeof r?r:void 0),"string"==typeof r?this.action=r:null!=this.options.action&&(this.action=this.options.action),this.uri=null!=(h=this.options.ignoreUri)?h:{"":t.location.host+t.location.pathname},a=[this.options.namespace,this.uri].concat(function(){var e,t,i,n;for(i=this.options.keyAttributes,n=[],e=0,t=i.length;t>e;e++)o=i[e],n.push(this.element[o]);return n}.call(this)),this.storageKey=a.join("."),this.storageKeyDate="savedDate."+a.join("."),this.storageIndexKey=[this.options.namespace,"index",t.location.host].join("."),this.webStorage=t[this.options.webStorage],this.init()}return i.prototype.indexedItems=function(){return JSON.parse(this.webStorage[this.storageIndexKey])},i.prototype.remove=function(){var t,i;this.stop(),this.webStorage.removeItem(this.storageKey),this.webStorage.removeItem(this.storageKeyDate),t=e.Event("phnx.removed"),this.$element.trigger(t),i=this.indexedItems(),i.slice(e.inArray(this.storageKey,i),1),this.webStorage[this.storageIndexKey]=JSON.stringify(i)},i.prototype.updateIndex=function(){var t;t=this.indexedItems(),-1===e.inArray(this.storageKey,t)&&(t.push(this.storageKey),t.length>this.options.maxItems&&(this.webStorage.removeItem(t[0]),t.shift()),this.webStorage[this.storageIndexKey]=JSON.stringify(t))},i.prototype.load=function(){var t,i,n,s,r;return n=this.webStorage[this.storageKeyDate],this.options.expireTime&&parseInt(n)+parseInt(this.options.expireTime)<(new Date).getTime()&&this.remove(),s=this.webStorage[this.storageKey],null!=s?(this.$element.is(":checkbox")?this.element.checked=JSON.parse(s):this.$element.is(":radio")?(this.$element.prop("checked",!1),r=JSON.parse(s),t=e("[name='"+this.element.name+"'][value='"+r+"']"),t.is(":checked")||t.prop("checked",!0).click()):"SELECT"===this.element.tagName?(this.$element.find("option").prop("selected",!1),e.each(JSON.parse(s),function(e){return function(t,i){return e.$element.find("option[value='"+i+"']").prop("selected",!0)}}(this))):this.element.value=s,i=e.Event("phnx.loaded"),this.$element.trigger(i)):void 0},i.prototype.save=function(){var t,i,n;return this.webStorage[this.storageKeyDate]=(new Date).getTime(),this.webStorage[this.storageKey]=this.$element.is(":checkbox")?this.element.checked:this.$element.is(":radio")?(i=this.$element.val(),JSON.stringify(i)):"SELECT"===this.element.tagName?(n=e.map(this.$element.find("option:selected"),function(e){return e.value}),JSON.stringify(n)):this.element.value,t=e.Event("phnx.saved"),this.$element.trigger(t),this.updateIndex()},i.prototype.start=function(){var t,i;return i=this.options.saveInterval>=0?setInterval(function(e){return function(){return e.save()}}(this),this.options.saveInterval):setTimeout(function(e){return function(){return e.save()}}(this)),r.push(i),t=e.Event("phnx.started"),this.$element.trigger(t)},i.prototype.stop=function(){var t;return r.forEach(function(e){return clearInterval(e)}),t=e.Event("phnx.stopped"),this.$element.trigger(t)},i.prototype.init=function(){switch(void 0===this.webStorage[this.storageIndexKey]&&(this.webStorage[this.storageIndexKey]="[]"),this.action){case"remove":return this.remove();case"start":return this.start();case"stop":return this.stop();case"load":return this.load();case"save":return this.save();default:if(this.load(),this.start(),this.options.clearOnSubmit&&e(this.options.clearOnSubmit).submit(function(e){return function(){return e.remove()}}(this)),this.options.saveOnInput&&e(this.element).on("input",function(e){return function(){return e.save()}}(this)),this.options.saveOnChange)return e(this.element).change(function(e){return function(){return e.save()}}(this))}},i}(),o=function(e){try{return e in t&&null!==t[e]}catch(i){return!1}},e.fn[s]=function(t){var r;return r="plugin_"+s,this.each(function(){return!e.data(this,r)||o(t.webStorage||n.webStorage)?e.data(this,r,new i(this,t)):void 0})}}(jQuery,window);